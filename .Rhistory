d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
new <- c(b,c,d,e,f,g,h)
delidx <- unique(new)
inmi_select <- inmi[c(delidx),]
inmi2 <- inmi_select[-c(a),]
inmi2$BirthCountry[g] <- "Europe"
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
inmi2$BirthCountry[g] <- "Europe"
test <- inmi2$BirthCountry
test
test[g]
test[1]
test[2]
test[g]
test[c(g)]
test
g
test
test[100]
test[500]
test[10000]
length(test)
test[950]
test[which(inmi$BirthCountry == "UE28 sin España")]
test[test == "España"]
new <- c(b,c,d,e,f,g,h)
delidx <- unique(new)
inmi_select <- inmi[c(delidx),]  # Select indices of relevant observations/continents
inmi2 <- inmi_select[-c(a),] # Remove Total Nacional
inmi2$BirthCountry[inmi2$BirthCountry == "UE28 sin España"] <- "Europe"
inmi2$BirthCountry[inmi2$BirthCountry == "España"] <- "Europe"
view(inmi2)
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4) #Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total))
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year"))
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Final Dataset so far
df_final <- merge(df_add_renta, pop, by = c("AR","Year"))
view(df_final)
inmi2
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants))
new <- c(b,c,d,e,f,g,h)
delidx <- unique(new)
inmi_select <- inmi[c(delidx),]  # Select indices of relevant observations/continents
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- i
new <- c(b,c,d,e,f,g,h)
delidx <- unique(new)
inmi_select <- inmi[c(delidx),]  # Select indices of relevant observations/continents
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants))
view(inmi2)
view(inmi)
view(inmi_select)
view(inmi1)
view(inmi)
view(inmi_select)
length(a)
view(inmi)
unique(inmi$BirthCountry)
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i)
new <- c(b,c,d,e,f,g,h,i)
inmi_select <- inmi[c(new),]  # Select indices of relevant observations/continents
view(inmi_select)
inmi_select <- inmi[c(new,-a),]  # Select indices of relevant observations/continents
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants))
view(inmi2)
crime
# Filter out irrelevant/repeated info
# Select continent index - merge all indexes - delete irrelevant observations
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
# Sum UE28 and Spanish migrants together as Europe category.
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants))
## inmi2 has the migrants across continents and year.
# Removing years for which we don't have common data
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4)
#Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
# Convert crime dataset to a compatible format to merge it later.
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))  # Migrants dataframe with crime rates.
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total))
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year")) # Migrants + Crime rates + Unemployment
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Migrants + Crime rates + Unemployment + Household income
df_final <- merge(df_add_renta, pop, by = c("AR","Year")) # Final Dataset so far
view(df_final)
df_final
df_add_paro
uploy_annual
inmi <- read_csv2("inmi.csv") # Migrants from outside of Spain
crime <- read_csv("crime.csv") # Crime rate
crime <- crime[-c(20,21,22,23),]
uploy <- read.delim2("tasaparo.csv", fileEncoding="latin1") # Tasa paro
uploy <- uploy[,c(2,4,5)]
renta <- read.delim2("renta.csv", fileEncoding="latin1")
renta <- renta[,c(1,3,4)]
renta$Total <- as.numeric(renta$Total)*1000 # Easy change the decimal symbol.
pop <- read.delim2("pop.csv", fileEncoding="latin1", dec = ",")
pop <- pop[,c(1,3,4)]
pop$Total <- gsub("[.]", "", pop$Total) #Remove "." to convert the variable to numeric.
pop$Total <- as.numeric(pop$Total)
names(uploy)[1] <- "AR"
names(uploy)[2] <- "Year"
names(renta)[1] <- "AR"
names(renta)[2] <- "Year"
names(renta)[3] <- "Renta"
names(inmi)[1] <- "AR"
names(inmi)[2] <- "BirthCountry"
names(inmi)[3] <- "Year"
names(inmi)[4] <- "Migrants"
names(pop)[1] <- "AR"
names(pop)[2] <- "Year"
names(pop)[3] <- "Pop"
# Filter out irrelevant/repeated info
# Select continent index - merge all indexes - delete irrelevant observations
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
# Sum UE28 and Spanish migrants together as Europe category.
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants))
## inmi2 has the migrants across continents and year.
# Removing years for which we don't have common data
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4)
#Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
# Convert crime dataset to a compatible format to merge it later.
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))  # Migrants dataframe with crime rates.
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total))
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year")) # Migrants + Crime rates + Unemployment
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Migrants + Crime rates + Unemployment + Household income
df_final <- merge(df_add_renta, pop, by = c("AR","Year")) # Final Dataset so far
df_final
view(df_final)
df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)
test <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)
view(test)
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)
view(df_wide)
test <- df_wide
test[,1:3] <- c("1","2","3")
names(test[,1:3]) <- c("1","2","3")
test
names(test)
names(test)
colnames(test)
colnames(test)[1]
colnames(test)[1:3]
colnames(test)[1:3] <- c("1","2","3")
names(Test)
names(test)
names(df_wide)
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CentralAmerica_Caribbean", "Migrants_Europe","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
view(df_wide)
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean", "Migrants_Europe","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
transform
df_wide
dF_wide_share <- transform(df_wide, df_wide[,7] = df_wide[,7]/Pop*100)
dF_wide_share <- transform(df_wide, Migrants_Africa[,7] = Migrants_Africa/Pop*100)
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa/Pop*100)
13-7
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
df_wide
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa/Pop*100, Migrants_Asia = Migrants_Asia/Pop*100, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean/Pop*100, Migrants_SAmerica = Migrants_SAmerica/Pop*100, Migrants_Europe = Migrants_Europe/Pop*100, Migrants_Oceania = Migrants_Oceania/Pop*100)
df_wide_share
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa/Pop*100, Migrants_Asia = Migrants_Asia/Pop*100,Migrants_NAmerica = Migrants_NAmerica/Pop*100, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean/Pop*100, Migrants_SAmerica = Migrants_SAmerica/Pop*100, Migrants_Europe = Migrants_Europe/Pop*100, Migrants_Oceania = Migrants_Oceania/Pop*100)
view(df_wide_share)
# Filter out irrelevant/repeated info
# Select continent index - merge all indexes - delete irrelevant observations
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
# Sum UE28 and Spanish migrants together as Europe category.
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants, na.rm = TRUE))
## inmi2 has the migrants across continents and year.
# Removing years for which we don't have common data
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4)
#Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
# Convert crime dataset to a compatible format to merge it later.
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))  # Migrants dataframe with crime rates.
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total))
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year")) # Migrants + Crime rates + Unemployment
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Migrants + Crime rates + Unemployment + Household income
df_final <- merge(df_add_renta, pop, by = c("AR","Year")) # Final data set so far.
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa/Pop*100, Migrants_Asia = Migrants_Asia/Pop*100,Migrants_NAmerica = Migrants_NAmerica/Pop*100, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean/Pop*100, Migrants_SAmerica = Migrants_SAmerica/Pop*100, Migrants_Europe = Migrants_Europe/Pop*100, Migrants_Oceania = Migrants_Oceania/Pop*100)
view(df_wide_share)
inmi
view(inmi2)
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total, na.rm = TRUE))
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa*100/Pop, Migrants_Asia = Migrants_Asia*100/Pop,Migrants_NAmerica = Migrants_NAmerica*100/Pop, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean*100/Pop, Migrants_SAmerica = Migrants_SAmerica*100/Pop, Migrants_Europe = Migrants_Europe*100/Pop, Migrants_Oceania = Migrants_Oceania*100/Pop)
df_wide
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
df_wide
# Filter out irrelevant/repeated info
# Select continent index - merge all indexes - delete irrelevant observations
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
# Sum UE28 and Spanish migrants together as Europe category.
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants, na.rm = TRUE))
## inmi2 has the migrants across continents and year.
# Removing years for which we don't have common data
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4)
#Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
# Convert crime dataset to a compatible format to merge it later.
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))  # Migrants dataframe with crime rates.
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total, na.rm = TRUE))
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year")) # Migrants + Crime rates + Unemployment
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Migrants + Crime rates + Unemployment + Household income
df_final <- merge(df_add_renta, pop, by = c("AR","Year")) # Final data set so far.
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa*100/Pop, Migrants_Asia = Migrants_Asia*100/Pop,Migrants_NAmerica = Migrants_NAmerica*100/Pop, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean*100/Pop, Migrants_SAmerica = Migrants_SAmerica*100/Pop, Migrants_Europe = Migrants_Europe*100/Pop, Migrants_Oceania = Migrants_Oceania*100/Pop)
df_final
uploy_annual
df
df_add_paro
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total, na.rm = TRUE))
uploy_annual
uploy
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total))
uploy_annual
uploy
view(uploy)
inmi <- read_csv2("inmi.csv") # Migrants from outside of Spain
crime <- read_csv("crime.csv") # Crime rate
crime <- crime[-c(20,21,22,23),]
uploy <- read.delim2("tasaparo.csv", fileEncoding="latin1") # Tasa paro
uploy <- uploy[,c(2,4,5)]
renta <- read.delim2("renta.csv", fileEncoding="latin1")
renta <- renta[,c(1,3,4)]
renta$Total <- as.numeric(renta$Total)*1000 # Easy change the decimal symbol.
pop <- read.delim2("pop.csv", fileEncoding="latin1", dec = ",")
pop <- pop[,c(1,3,4)]
pop$Total <- gsub("[.]", "", pop$Total) #Remove "." to convert the variable to numeric.
pop$Total <- as.numeric(pop$Total)
names(uploy)[1] <- "AR"
names(uploy)[2] <- "Year"
names(renta)[1] <- "AR"
names(renta)[2] <- "Year"
names(renta)[3] <- "Renta"
names(inmi)[1] <- "AR"
names(inmi)[2] <- "BirthCountry"
names(inmi)[3] <- "Year"
names(inmi)[4] <- "Migrants"
names(pop)[1] <- "AR"
names(pop)[2] <- "Year"
names(pop)[3] <- "Pop"
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total, na.rm = TRUE))
inmi <- read_csv2("inmi.csv") # Migrants from outside of Spain
crime <- read_csv("crime.csv") # Crime rate
crime <- crime[-c(20,21,22,23),]
uploy <- read.delim2("tasaparo.csv", fileEncoding="latin1") # Tasa paro
uploy <- uploy[,c(2,4,5)]
renta <- read.delim2("renta.csv", fileEncoding="latin1")
renta <- renta[,c(1,3,4)]
renta$Total <- as.numeric(renta$Total)*1000 # Easy change the decimal symbol.
pop <- read.delim2("pop.csv", fileEncoding="latin1", dec = ",")
pop <- pop[,c(1,3,4)]
pop$Total <- gsub("[.]", "", pop$Total) #Remove "." to convert the variable to numeric.
pop$Total <- as.numeric(pop$Total)
names(uploy)[1] <- "AR"
names(uploy)[2] <- "Year"
names(renta)[1] <- "AR"
names(renta)[2] <- "Year"
names(renta)[3] <- "Renta"
names(inmi)[1] <- "AR"
names(inmi)[2] <- "BirthCountry"
names(inmi)[3] <- "Year"
names(inmi)[4] <- "Migrants"
names(pop)[1] <- "AR"
names(pop)[2] <- "Year"
names(pop)[3] <- "Pop"
# Filter out irrelevant/repeated info
# Select continent index - merge all indexes - delete irrelevant observations
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
# Sum UE28 and Spanish migrants together as Europe category.
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants, na.rm = TRUE))
## inmi2 has the migrants across continents and year.
# Removing years for which we don't have common data
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4)
#Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
# Convert crime dataset to a compatible format to merge it later.
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))  # Migrants dataframe with crime rates.
# Converting to annual Paro data.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total, na.rm = TRUE))
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year")) # Migrants + Crime rates + Unemployment
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Migrants + Crime rates + Unemployment + Household income
df_final <- merge(df_add_renta, pop, by = c("AR","Year")) # Final data set so far.
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa*100/Pop, Migrants_Asia = Migrants_Asia*100/Pop,Migrants_NAmerica = Migrants_NAmerica*100/Pop, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean*100/Pop, Migrants_SAmerica = Migrants_SAmerica*100/Pop, Migrants_Europe = Migrants_Europe*100/Pop, Migrants_Oceania = Migrants_Oceania*100/Pop)
uploy_annual
view(df_wide_share)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(gganimate)
library(dplyr)
inmi <- read_csv2("inmi.csv") # Migrants from outside of Spain
crime <- read_csv("crime.csv") # Crime rate
crime <- crime[-c(20,21,22,23),]
uploy <- read.delim2("tasaparo.csv", fileEncoding="latin1") # Tasa paro
uploy <- uploy[,c(2,4,5)]
renta <- read.delim2("renta.csv", fileEncoding="latin1")
renta <- renta[,c(1,3,4)]
renta$Total <- as.numeric(renta$Total)*1000 # Easy change the decimal symbol.
pop <- read.delim2("pop.csv", fileEncoding="latin1", dec = ",")
pop <- pop[,c(1,3,4)]
pop$Total <- gsub("[.]", "", pop$Total) #Remove "." to convert the variable to numeric.
pop$Total <- as.numeric(pop$Total)
names(uploy)[1] <- "AR"
names(uploy)[2] <- "Year"
names(renta)[1] <- "AR"
names(renta)[2] <- "Year"
names(renta)[3] <- "Renta"
names(inmi)[1] <- "AR"
names(inmi)[2] <- "BirthCountry"
names(inmi)[3] <- "Year"
names(inmi)[4] <- "Migrants"
names(pop)[1] <- "AR"
names(pop)[2] <- "Year"
names(pop)[3] <- "Pop"
# Filter out irrelevant/repeated info
# Select continent index - merge all indexes - delete irrelevant observations
b <- which(inmi$BirthCountry == "Sudamérica")
c <- which(inmi$BirthCountry == "África")
d <- which(inmi$BirthCountry == "Centro América y Caribe")
e <- which(inmi$BirthCountry == "Asia")
f <- which(inmi$BirthCountry == "América del Norte")
g <- which(inmi$BirthCountry == "UE28 sin España")
h <- which(inmi$BirthCountry == "España")
i <- which(inmi$BirthCountry == "Oceanía")
new <- c(b,c,d,e,f,g,h,i) # Select indices of relevant observations/continents
inmi_select <- inmi[c(new),]
a <- which(inmi_select$AR == "Total Nacional")
inmi1 <- inmi_select[-c(a),] # Remove Total Nacional
# Sum UE28 and Spanish migrants together as Europe category.
inmi1$BirthCountry[inmi1$BirthCountry == "UE28 sin España"] <- "Europe"
inmi1$BirthCountry[inmi1$BirthCountry == "España"] <- "Europe"
inmi2 <- inmi1 |> group_by(AR,Year,BirthCountry) |> summarise(Migrants = sum(Migrants, na.rm = TRUE)) # inmi2 has the migrants across continents and year.
# Removing years for which we don't have common data
remov <- c(which(inmi2$Year == 2008),which(inmi2$Year == 2009))
removidx <- unique(remov)
inmi2 <- inmi2[-c(removidx),]
inmi2$AR <- substring(inmi2$AR,4)
#Remove numbers from AR names
uploy$Year <- substring(uploy$Year,1,4)
uploy$AR <- substring(uploy$AR,4)
renta$AR <- substring(renta$AR,4)
pop$AR <- substring(pop$AR,4)
# Convert crime dataset to a compatible format to merge it later.
pivot <- pivot_longer(crime,2:13, names_to = "Year", values_to = "CrimeRate")
df <- merge(inmi2,pivot, by = c("AR","Year"))  # Migrants dataframe with crime rates.
uploy_annual <- uploy %>%  group_by(AR,Year) %>%  summarise(Paro = mean(Total, na.rm = TRUE))# Converting to annual Paro data.
df_add_paro <- merge(df,uploy_annual, by = c("AR","Year")) # Migrants + Crime rates + Unemployment
df_add_renta <- merge(df_add_paro, renta, by = c("AR","Year")) # Migrants + Crime rates + Unemployment + Household income
df_final <- merge(df_add_renta, pop, by = c("AR","Year")) # Final data set so far.
df_wide <- df_final |> pivot_wider(names_from = BirthCountry, values_from = Migrants)  # Final data set with migrants and Birthcountry made wider as column variables.
colnames(df_wide)[7:13] <- c("Migrants_Africa","Migrants_NAmerica", "Migrants_Asia","Migrants_CAmerica_Caribbean","Migrants_Europe","Migrants_Oceania", "Migrants_SAmerica")
# Migrants/Population share
df_wide_share <- transform(df_wide, Migrants_Africa = Migrants_Africa*100/Pop, Migrants_Asia = Migrants_Asia*100/Pop,Migrants_NAmerica = Migrants_NAmerica*100/Pop, Migrants_CAmerica_Caribbean = Migrants_CAmerica_Caribbean*100/Pop, Migrants_SAmerica = Migrants_SAmerica*100/Pop, Migrants_Europe = Migrants_Europe*100/Pop, Migrants_Oceania = Migrants_Oceania*100/Pop)
view(df_wide_share)
boxplot(df_wide_share[,7:10])
boxplot(df_wide_share[,7:12])
ggplot(df_wide_share,aes(df_wide_share[,7:10])) + geom_boxplot()
ggplot(df_wide_share,aes(x = df_wide_share[,7:10])) + geom_boxplot()
ggplot(df_wide_share,aes(x = Migrants_Africa)) + geom_boxplot()
ggplot(df_wide_share,aes(y = Migrants_Africa)) + geom_boxplot()
ts
